const fs = require('fs')
const path = require('path')
const test = require('blue-tape')
const { emp, empSync, isEmpty, isEmptySync } = require('../dist/index.js')

/**
 * Constants
 */

const fileContent = 'testing file content\n'
const testDirPath = path.join(__dirname, '../TestFolder')
const filename = 'file.txt'

/**
 * Utils
 */

function makeFiles() {
  fs.mkdirSync(testDirPath)
  fs.writeFileSync(`${testDirPath}/${filename}`, fileContent)
}

function cleanFiles() {
  empSync(testDirPath, true)
}

/**
 * Test cases
 */

test('Clean files and dirs, test starts', async t => cleanFiles())

test('ASYNC methods', async t => {
  // no target
  try {
    await isEmpty(testDirPath)
  } catch (e) {
    t.ok(e, 'should throw error when target not exists')
  }
  await emp(testDirPath)

  // make files and dirs
  makeFiles()

  t.ok(await isEmpty(testDirPath))
  await emp(testDirPath)

  cleanFiles()
})

test('SYNC methods', async t => {
  // no target
  t.throws(
    () => isEmptySync(testDirPath),
    'should throw error when target not exists'
  )
  empSync(testDirPath)

  // make files and dirs
  makeFiles()

  t.ok(isEmptySync(testDirPath))
  empSync(testDirPath)

  cleanFiles()
})

test('Clean files and dirs, test stops', async t => cleanFiles())
